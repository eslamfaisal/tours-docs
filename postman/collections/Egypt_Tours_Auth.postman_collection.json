{
     "info": {
          "_postman_id": "auth-collection-001",
          "name": "Egypt Tours - Auth",
          "description": "Authentication endpoints for the Egypt Tours Platform.\n\nSource: docs/api/auth.md",
          "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
     },
     "auth": {
          "type": "bearer",
          "bearer": [
               {
                    "key": "token",
                    "value": "{{accessToken}}",
                    "type": "string"
               }
          ]
     },
     "event": [
          {
               "listen": "prerequest",
               "script": {
                    "type": "text/javascript",
                    "exec": [
                         "// Auto-refresh token if expired",
                         "const tokenExpiry = pm.environment.get('tokenExpiry');",
                         "const now = Date.now();",
                         "",
                         "if (tokenExpiry && now > tokenExpiry - 60000) {",
                         "    pm.sendRequest({",
                         "        url: pm.environment.get('baseUrl') + '/auth/refresh',",
                         "        method: 'POST',",
                         "        header: { 'Content-Type': 'application/json' },",
                         "        body: {",
                         "            mode: 'raw',",
                         "            raw: JSON.stringify({ refreshToken: pm.environment.get('refreshToken') })",
                         "        }",
                         "    }, function (err, res) {",
                         "        if (res && res.code === 200) {",
                         "            var data = res.json();",
                         "            pm.environment.set('accessToken', data.data.accessToken);",
                         "            pm.environment.set('tokenExpiry', Date.now() + 3600000);",
                         "        }",
                         "    });",
                         "}"
                    ]
               }
          }
     ],
     "item": [
          {
               "name": "Register",
               "request": {
                    "auth": {
                         "type": "noauth"
                    },
                    "method": "POST",
                    "header": [
                         {
                              "key": "Content-Type",
                              "value": "application/json"
                         }
                    ],
                    "body": {
                         "mode": "raw",
                         "raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecureP@ss123\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\",\n  \"phone\": \"+1234567890\"\n}"
                    },
                    "url": {
                         "raw": "{{baseUrl}}/auth/register",
                         "host": [
                              "{{baseUrl}}"
                         ],
                         "path": [
                              "auth",
                              "register"
                         ]
                    },
                    "description": "Register a new user account.\n\nSource: docs/api/auth.md → POST /auth/register"
               },
               "response": [
                    {
                         "name": "Success - 201",
                         "originalRequest": {
                              "method": "POST",
                              "url": "{{baseUrl}}/auth/register"
                         },
                         "status": "Created",
                         "code": 201,
                         "body": "{\n  \"success\": true,\n  \"message\": \"Registration successful. Please check your email for verification.\"\n}"
                    },
                    {
                         "name": "Error - Email Already Exists",
                         "status": "Conflict",
                         "code": 409,
                         "body": "{\n  \"success\": false,\n  \"error\": {\n    \"code\": \"EMAIL_ALREADY_EXISTS\",\n    \"message\": \"Email already registered\"\n  }\n}"
                    }
               ],
               "event": [
                    {
                         "listen": "test",
                         "script": {
                              "type": "text/javascript",
                              "exec": [
                                   "pm.test('Status code is 201', function () {",
                                   "    pm.response.to.have.status(201);",
                                   "});",
                                   "",
                                   "pm.test('Response has success true', function () {",
                                   "    var jsonData = pm.response.json();",
                                   "    pm.expect(jsonData.success).to.be.true;",
                                   "});"
                              ]
                         }
                    }
               ]
          },
          {
               "name": "Login",
               "request": {
                    "auth": {
                         "type": "noauth"
                    },
                    "method": "POST",
                    "header": [
                         {
                              "key": "Content-Type",
                              "value": "application/json"
                         }
                    ],
                    "body": {
                         "mode": "raw",
                         "raw": "{\n  \"email\": \"{{email}}\",\n  \"password\": \"{{password}}\"\n}"
                    },
                    "url": {
                         "raw": "{{baseUrl}}/auth/login",
                         "host": [
                              "{{baseUrl}}"
                         ],
                         "path": [
                              "auth",
                              "login"
                         ]
                    },
                    "description": "Authenticate user and receive JWT tokens.\n\nSource: docs/api/auth.md → POST /auth/login"
               },
               "response": [
                    {
                         "name": "Success - 200",
                         "status": "OK",
                         "code": 200,
                         "body": "{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"dGhpcyBpcyBhIHJlZnJlc2...\",\n    \"expiresIn\": 3600,\n    \"user\": {\n      \"id\": 12345,\n      \"email\": \"user@example.com\",\n      \"firstName\": \"John\",\n      \"lastName\": \"Doe\",\n      \"role\": \"CUSTOMER\"\n    }\n  }\n}"
                    },
                    {
                         "name": "Error - Invalid Credentials",
                         "status": "Unauthorized",
                         "code": 401,
                         "body": "{\n  \"success\": false,\n  \"error\": {\n    \"code\": \"INVALID_CREDENTIALS\",\n    \"message\": \"Wrong email/password\"\n  }\n}"
                    }
               ],
               "event": [
                    {
                         "listen": "prerequest",
                         "script": {
                              "type": "text/javascript",
                              "exec": [
                                   "// Clear existing tokens before login",
                                   "pm.environment.unset('accessToken');",
                                   "pm.environment.unset('refreshToken');",
                                   "pm.environment.unset('tokenExpiry');"
                              ]
                         }
                    },
                    {
                         "listen": "test",
                         "script": {
                              "type": "text/javascript",
                              "exec": [
                                   "pm.test('Status code is 200', function () {",
                                   "    pm.response.to.have.status(200);",
                                   "});",
                                   "",
                                   "if (pm.response.code === 200) {",
                                   "    var jsonData = pm.response.json();",
                                   "    pm.environment.set('accessToken', jsonData.data.accessToken);",
                                   "    pm.environment.set('refreshToken', jsonData.data.refreshToken);",
                                   "    pm.environment.set('tokenExpiry', Date.now() + (jsonData.data.expiresIn * 1000));",
                                   "    console.log('Tokens saved to environment');",
                                   "}"
                              ]
                         }
                    }
               ]
          },
          {
               "name": "Refresh Token",
               "request": {
                    "auth": {
                         "type": "noauth"
                    },
                    "method": "POST",
                    "header": [
                         {
                              "key": "Content-Type",
                              "value": "application/json"
                         }
                    ],
                    "body": {
                         "mode": "raw",
                         "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
                    },
                    "url": {
                         "raw": "{{baseUrl}}/auth/refresh",
                         "host": [
                              "{{baseUrl}}"
                         ],
                         "path": [
                              "auth",
                              "refresh"
                         ]
                    },
                    "description": "Refresh access token using refresh token.\n\nSource: docs/api/auth.md → POST /auth/refresh"
               },
               "response": [
                    {
                         "name": "Success - 200",
                         "status": "OK",
                         "code": 200,
                         "body": "{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"expiresIn\": 3600\n  }\n}"
                    }
               ],
               "event": [
                    {
                         "listen": "test",
                         "script": {
                              "type": "text/javascript",
                              "exec": [
                                   "if (pm.response.code === 200) {",
                                   "    var jsonData = pm.response.json();",
                                   "    pm.environment.set('accessToken', jsonData.data.accessToken);",
                                   "    pm.environment.set('tokenExpiry', Date.now() + (jsonData.data.expiresIn * 1000));",
                                   "}"
                              ]
                         }
                    }
               ]
          },
          {
               "name": "Forgot Password",
               "request": {
                    "auth": {
                         "type": "noauth"
                    },
                    "method": "POST",
                    "header": [
                         {
                              "key": "Content-Type",
                              "value": "application/json"
                         }
                    ],
                    "body": {
                         "mode": "raw",
                         "raw": "{\n  \"email\": \"user@example.com\"\n}"
                    },
                    "url": {
                         "raw": "{{baseUrl}}/auth/forgot-password",
                         "host": [
                              "{{baseUrl}}"
                         ],
                         "path": [
                              "auth",
                              "forgot-password"
                         ]
                    },
                    "description": "Request password reset email.\n\nSource: docs/api/auth.md → POST /auth/forgot-password"
               },
               "response": [
                    {
                         "name": "Success - 200",
                         "status": "OK",
                         "code": 200,
                         "body": "{\n  \"success\": true,\n  \"message\": \"Password reset instructions sent to email.\"\n}"
                    }
               ]
          },
          {
               "name": "Reset Password",
               "request": {
                    "auth": {
                         "type": "noauth"
                    },
                    "method": "POST",
                    "header": [
                         {
                              "key": "Content-Type",
                              "value": "application/json"
                         }
                    ],
                    "body": {
                         "mode": "raw",
                         "raw": "{\n  \"token\": \"reset_token_from_email\",\n  \"password\": \"NewSecureP@ss123\"\n}"
                    },
                    "url": {
                         "raw": "{{baseUrl}}/auth/reset-password",
                         "host": [
                              "{{baseUrl}}"
                         ],
                         "path": [
                              "auth",
                              "reset-password"
                         ]
                    },
                    "description": "Reset password using token from email.\n\nSource: docs/api/auth.md → POST /auth/reset-password"
               },
               "response": [
                    {
                         "name": "Success - 200",
                         "status": "OK",
                         "code": 200,
                         "body": "{\n  \"success\": true,\n  \"message\": \"Password reset successful.\"\n}"
                    }
               ]
          },
          {
               "name": "Google OAuth",
               "request": {
                    "auth": {
                         "type": "noauth"
                    },
                    "method": "POST",
                    "header": [
                         {
                              "key": "Content-Type",
                              "value": "application/json"
                         }
                    ],
                    "body": {
                         "mode": "raw",
                         "raw": "{\n  \"idToken\": \"google_id_token_from_client\"\n}"
                    },
                    "url": {
                         "raw": "{{baseUrl}}/auth/google",
                         "host": [
                              "{{baseUrl}}"
                         ],
                         "path": [
                              "auth",
                              "google"
                         ]
                    },
                    "description": "Authenticate using Google OAuth.\n\nSource: docs/api/auth.md → POST /auth/google"
               },
               "response": [
                    {
                         "name": "Success - 200",
                         "status": "OK",
                         "code": 200,
                         "body": "{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"dGhpcyBpcyBhIHJlZnJlc2...\",\n    \"expiresIn\": 3600,\n    \"user\": {\n      \"id\": 12345,\n      \"email\": \"user@gmail.com\",\n      \"firstName\": \"John\",\n      \"lastName\": \"Doe\",\n      \"role\": \"CUSTOMER\"\n    }\n  }\n}"
                    }
               ],
               "event": [
                    {
                         "listen": "test",
                         "script": {
                              "type": "text/javascript",
                              "exec": [
                                   "if (pm.response.code === 200) {",
                                   "    var jsonData = pm.response.json();",
                                   "    pm.environment.set('accessToken', jsonData.data.accessToken);",
                                   "    pm.environment.set('refreshToken', jsonData.data.refreshToken);",
                                   "    pm.environment.set('tokenExpiry', Date.now() + (jsonData.data.expiresIn * 1000));",
                                   "}"
                              ]
                         }
                    }
               ]
          },
          {
               "name": "Facebook OAuth",
               "request": {
                    "auth": {
                         "type": "noauth"
                    },
                    "method": "POST",
                    "header": [
                         {
                              "key": "Content-Type",
                              "value": "application/json"
                         }
                    ],
                    "body": {
                         "mode": "raw",
                         "raw": "{\n  \"accessToken\": \"facebook_access_token\"\n}"
                    },
                    "url": {
                         "raw": "{{baseUrl}}/auth/facebook",
                         "host": [
                              "{{baseUrl}}"
                         ],
                         "path": [
                              "auth",
                              "facebook"
                         ]
                    },
                    "description": "Authenticate using Facebook OAuth.\n\nSource: docs/api/auth.md → POST /auth/facebook"
               },
               "response": [
                    {
                         "name": "Success - 200",
                         "status": "OK",
                         "code": 200,
                         "body": "{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"refreshToken\": \"dGhpcyBpcyBhIHJlZnJlc2...\",\n    \"expiresIn\": 3600,\n    \"user\": {\n      \"id\": 12346,\n      \"email\": \"user@facebook.com\",\n      \"firstName\": \"Jane\",\n      \"lastName\": \"Doe\",\n      \"role\": \"CUSTOMER\"\n    }\n  }\n}"
                    }
               ],
               "event": [
                    {
                         "listen": "test",
                         "script": {
                              "type": "text/javascript",
                              "exec": [
                                   "if (pm.response.code === 200) {",
                                   "    var jsonData = pm.response.json();",
                                   "    pm.environment.set('accessToken', jsonData.data.accessToken);",
                                   "    pm.environment.set('refreshToken', jsonData.data.refreshToken);",
                                   "    pm.environment.set('tokenExpiry', Date.now() + (jsonData.data.expiresIn * 1000));",
                                   "}"
                              ]
                         }
                    }
               ]
          },
          {
               "name": "Verify Email",
               "request": {
                    "auth": {
                         "type": "noauth"
                    },
                    "method": "GET",
                    "url": {
                         "raw": "{{baseUrl}}/auth/verify-email?token=verification_token",
                         "host": [
                              "{{baseUrl}}"
                         ],
                         "path": [
                              "auth",
                              "verify-email"
                         ],
                         "query": [
                              {
                                   "key": "token",
                                   "value": "verification_token"
                              }
                         ]
                    },
                    "description": "Verify email address using token from email.\n\nSource: docs/api/auth.md → GET /auth/verify-email"
               },
               "response": [
                    {
                         "name": "Success - 200",
                         "status": "OK",
                         "code": 200,
                         "body": "{\n  \"success\": true,\n  \"message\": \"Email verified successfully.\"\n}"
                    }
               ]
          },
          {
               "name": "Logout",
               "request": {
                    "method": "POST",
                    "url": {
                         "raw": "{{baseUrl}}/auth/logout",
                         "host": [
                              "{{baseUrl}}"
                         ],
                         "path": [
                              "auth",
                              "logout"
                         ]
                    },
                    "description": "Invalidate current session and tokens.\n\nSource: docs/api/auth.md → POST /auth/logout"
               },
               "response": [
                    {
                         "name": "Success - 200",
                         "status": "OK",
                         "code": 200,
                         "body": "{\n  \"success\": true,\n  \"message\": \"Logged out successfully.\"\n}"
                    }
               ],
               "event": [
                    {
                         "listen": "test",
                         "script": {
                              "type": "text/javascript",
                              "exec": [
                                   "if (pm.response.code === 200) {",
                                   "    pm.environment.unset('accessToken');",
                                   "    pm.environment.unset('refreshToken');",
                                   "    pm.environment.unset('tokenExpiry');",
                                   "    console.log('Tokens cleared from environment');",
                                   "}"
                              ]
                         }
                    }
               ]
          }
     ]
}